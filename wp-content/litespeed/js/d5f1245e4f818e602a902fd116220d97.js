(function($){"use strict";$(document).ready(function(){var defaultCategories=[{label:"Default",children:[{label:"Item 1"},{label:"Item 2"}],},];function hasRealChildren(item){if(!item.children||item.children.length===0){return!1}
if(item.children.length===1){var child=item.children[0];if(child.value===item.value&&child.id===item.id){return!1}
if(child.label==="All in "+item.label){return!1}}
return!0}
$(".drilldown-menu").each(function(){var $menu=$(this);var selectedItems=[];var menuStack=[];var initialized=!1;var singleSelect=$menu.data("single-select")===!0;var categories=$menu.data("categories");if(typeof categories==="string"){try{categories=JSON.parse(categories)}catch(e){categories=defaultCategories}}else if(!categories){categories=defaultCategories}
var $menuToggle=$menu.find(".menu-toggle");var $menuPanel=$menu.find(".menu-panel");var $menuLevelsContainer=$menu.find(".menu-levels");var $menuLabel=$menu.find(".menu-label");var $menuLabelText=$menu.data("label");var $resetButton=$menu.find(".reset-button");function itemMatchesSearch(item,searchTerm){if($.trim(searchTerm)==="")return!0;var lowerSearch=searchTerm.toLowerCase();if(item.label.toLowerCase().indexOf(lowerSearch)!==-1){return!0}
if(item.children&&item.children.length>0){for(var i=0;i<item.children.length;i++){if(itemMatchesSearch(item.children[i],searchTerm)){return!0}}}
return!1}
function initMenu(){menuStack=[];menuStack.push({data:categories,parent:null});$menuLevelsContainer.empty();var $levelElement=createMenuLevel(categories,0);$menuLevelsContainer.append($levelElement);updateMenuLevelPosition();updateMenuHeight();initializePreselectedValues()}
function createMenuLevel(data,levelIndex){var $levelDiv=$("<div/>").addClass("menu-level").attr("data-level",levelIndex);if(levelIndex>0){var $backButton=$("<button/>").addClass("back-button").text(listeo_core.back).on("click",function(e){e.stopPropagation();drillUp()});$levelDiv.append($backButton)}
var $searchInput=$("<input/>",{type:"text",placeholder:listeo_core.search,class:"menu-search",}).on("input",function(){filterMenuLevel($levelDiv,$searchInput.val())});$levelDiv.append($searchInput);var $itemsContainer=$("<div/>").addClass("menu-items");$levelDiv.append($itemsContainer);$.each(data,function(i,item){var $itemDiv=$("<div/>").addClass("menu-item").attr("data-label",item.label);if(item.value){$itemDiv.attr("data-value",item.value)}
if(item.id){$itemDiv.attr("data-id",item.id)}
$itemDiv.data("item",item);var $labelSpan=$("<span/>").addClass("item-label").text(item.label);$itemDiv.append($labelSpan);if(hasRealChildren(item)){var $arrowSpan=$("<span/>").addClass("arrow");$itemDiv.append($arrowSpan);$itemDiv.on("click",function(e){e.stopPropagation();drillDown(item)})}else{$itemDiv.on("click",function(e){e.stopPropagation();$(".category-item").removeClass("active");toggleSelection(item,$itemDiv)});if(isSelected(item)){$itemDiv.addClass("selected")}}
$itemsContainer.append($itemDiv)});return $levelDiv}
function filterMenuLevel($levelDiv,searchTerm){var $itemsContainer=$levelDiv.find(".menu-items");var $items=$itemsContainer.find(".menu-item");var anyVisible=!1;$levelDiv.find(".no-results").remove();$items.each(function(){var $item=$(this);var itemObj=$item.data("item");var label=itemObj.label;var lowerSearch=$.trim(searchTerm).toLowerCase();var directMatch=lowerSearch!==""&&label.toLowerCase().indexOf(lowerSearch)>-1;var matches=itemMatchesSearch(itemObj,searchTerm);if(matches){$item.css("display","flex");anyVisible=!0;var $labelSpan=$item.find(".item-label");$item.removeClass("child-match");$labelSpan.text(label);if($.trim(searchTerm)!==""){if(directMatch){var regex=new RegExp("("+escapeRegExp(searchTerm)+")","gi");$labelSpan.html(label.replace(regex,"<mark>$1</mark>"))}else{$item.addClass("child-match")}}}else{$item.css("display","none")}});if(!anyVisible){var $noResults=$("<div/>").addClass("no-results").text("No results");$itemsContainer.append($noResults)}
updateMenuHeight()}
function escapeRegExp(string){return string.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}
function drillDown(category){if(!category.children||category.children.length===0)return;var $currentLevel=$menuLevelsContainer.children().last();var parentSearchTerm=$currentLevel.find(".menu-search").val();menuStack.push({data:category.children,parent:category});var levelIndex=menuStack.length-1;var $newLevel=createMenuLevel(category.children,levelIndex);$newLevel.find(".menu-search").val(parentSearchTerm);filterMenuLevel($newLevel,parentSearchTerm);$menuLevelsContainer.append($newLevel);updateMenuLevelPosition();setTimeout(updateMenuHeight,0)}
function drillUp(){if(menuStack.length<=1)return;menuStack.pop();$menuLevelsContainer.children().last().remove();updateMenuLevelPosition();updateMenuHeight()}
function findItemByValue(categories,value){for(var i=0;i<categories.length;i++){var item=categories[i];if("#submit-listing-form".length){if(item.id==value){return item}}else{if(item.value===value||(!item.value&&item.label===value)){return item}}
if(item.children&&item.children.length>0){var found=findItemByValue(item.children,value);if(found)return found}}
return null}
if(!window.ListeoDrilldown)window.ListeoDrilldown={};window.ListeoDrilldown[$menu.attr("id")]={initMenu:initMenu,selectById:function(categoryId){initMenu();setTimeout(function(){const item=findItemByValue(categories,categoryId);if(item){const $fake=$("<div>").addClass("menu-item").attr("data-id",categoryId);toggleSelection(item,$fake)}else{resetSelections()}},20)},};function initializePreselectedValues(){selectedItems=[];var $originalInput=$menu.find("input.drilldown-values");var inputName=$menu.data("name");var $existingInputs=$menu.find('input[name="'+inputName+'[]"]');$existingInputs.each(function(){var value=$(this).val();if(value){var item=findItemByValue(categories,value.trim());if(item){selectedItems.push(item)}}});if(selectedItems.length>0){updateMainButton();updateHiddenInput()}}
initializePreselectedValues();function updateHiddenInput(){var $originalInput=$menu.find("input.drilldown-values");var inputName=$menu.data("name");$menu.find('input[name="'+inputName+'[]"]').remove();selectedItems.forEach(function(item){if($("#submit-listing-form").length){var value=item.id}else{var value=item.value||item.label}
$("<input>",{type:"hidden",name:inputName+"[]",value:value,"data-label":item.label,class:"drilldown-generated",}).appendTo($menu)});var target=$("div#listeo-listings-container");target.triggerHandler("update_results",[1,!1]);$menu.trigger("drilldown-updated")}
function updateMenuLevelPosition(){var levelIndex=menuStack.length-1;$menuLevelsContainer.css("transform","translateX(-"+levelIndex*100+"%)")}
function updateMenuHeight(){var $levels=$menuLevelsContainer.children();if($levels.length===0)return;var $activeLevel=$levels.last();$menuPanel.height($activeLevel[0].scrollHeight)}
function toggleSelection(item,$itemDiv){var index=selectedItems.findIndex(function(selected){return item.value&&selected.value?selected.value===item.value:selected.label===item.label});if(index>-1){selectedItems.splice(index,1);$itemDiv.removeClass("selected");$menu.find('.menu-item[data-value="'+(item.value||item.label)+'"]').removeClass("selected");if(item.id){$menu.find('.menu-item[data-id="'+item.id+'"]').removeClass("selected")}}else{if(singleSelect){$menu.find(".menu-item.selected").removeClass("selected");selectedItems=[]}
if(!isSelected(item)){selectedItems.push(item)}
$itemDiv.addClass("selected");$menu.find('.menu-item[data-value="'+(item.value||item.label)+'"]').addClass("selected");if(item.id){$menu.find('.menu-item[data-id="'+item.id+'"]').addClass("selected")}}
updateMainButton();updateHiddenInput()}
function isSelected(item){return selectedItems.some(function(selected){if($("#submit-listing-form").length){if(item.id&&selected.id){return selected.id===item.id}}else{if(item.value&&selected.value){return selected.value===item.value}}
return selected.label===item.label})}
function updateMainButton(){var searchTerm=$menuLevelsContainer.children().last().find(".menu-search").val()||"";if(selectedItems.length===0){$menuLabel.html($menuLabelText);$resetButton.hide();$menuToggle.removeClass("dd-chosen")}else if(selectedItems.length===1){var label=selectedItems[0].label;if($.trim(searchTerm)!==""){var regex=new RegExp("("+escapeRegExp(searchTerm)+")","gi");label=label.replace(regex,"<mark>$1</mark>")}
$menuLabel.html(label);$resetButton.show();$menuToggle.addClass("dd-chosen")}else{var label=selectedItems[0].label;if($.trim(searchTerm)!==""){var regex=new RegExp("("+escapeRegExp(searchTerm)+")","gi");label=label.replace(regex,"<mark>$1</mark>")}
$menuLabel.html(label+" +"+(selectedItems.length-1));$resetButton.show();$menuToggle.addClass("dd-chosen")}}
function resetSelections(){selectedItems=[];$menu.find(".menu-item.selected").removeClass("selected");$menuLevelsContainer.find(".menu-item.selected").removeClass("selected");console.log("$menuLabel:",$menuLabel);console.log("$menuLabelText:",$menuLabelText);console.log("Current label HTML:",$menuLabel.html());if($menuLabelText){$menuLabel.html($menuLabelText)}else{var originalText=$menu.data("label")||$menu.attr("data-label")||"Select an option";console.log("Using fallback text:",originalText);$menuLabel.html(originalText)}
$resetButton.hide();$menuToggle.removeClass("dd-chosen");updateHiddenInput()}
function openMenu(){$(".drilldown-menu").not($menu).each(function(){$(this).find(".menu-panel").removeClass("open");$(this).find(".menu-toggle").removeClass("dd-active")});if($.fn.selectpicker){$(".bootstrap-select.show").each(function(){$(this).removeClass("show");$(this).find(".dropdown-menu").removeClass("show")});$(".bootstrap-select.open").each(function(){$(this).removeClass("open");$(this).find(".dropdown-menu").removeClass("open")})}
$menuPanel.addClass("open");$menuToggle.addClass("dd-active");if(!initialized){initMenu();initialized=!0}else{restoreSelectedState()}}
function restoreSelectedState(){selectedItems.forEach(function(selectedItem){var selector="";if(selectedItem.id){selector='[data-id="'+selectedItem.id+'"]'}else if(selectedItem.value){selector='[data-value="'+selectedItem.value+'"]'}else{selector='[data-label="'+selectedItem.label+'"]'}
$menu.find(".menu-item"+selector).addClass("selected")});updateMainButton()}
function closeMenu(){$menuPanel.removeClass("open");$menuToggle.removeClass("dd-active")}
$menuToggle.on("click",function(e){e.stopPropagation();if($menuPanel.hasClass("open")){closeMenu()}else{openMenu()}});$resetButton.on("click",function(e){e.stopPropagation();resetSelections();$(".category-item").removeClass("active")});$(document).on("click",function(e){if(!$menu.is(e.target)&&$menu.has(e.target).length===0){closeMenu()}})});window.selectDrilldownCategoryById=function(categoryId){$(".drilldown-menu").each(function(){var $menu=$(this);var $matchingItem=$menu.find('.menu-item[data-id="${categoryId}"]');console.log("Matching item:",$matchingItem);if($matchingItem.length){$matchingItem.trigger("click");console.log("Item clicked:",$matchingItem.text())}})}})})(this.jQuery)
;